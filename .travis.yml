language: node_js

script:
  - npm run lint
  - npm run build

sudo: false

env:
  global:
  - CF_API="https://api.cloud.service.gov.uk"
  - CF_ORG="govuk-design-system"
  - CF_SPACE="production"
  - CF_USERNAME="design-system-deploy-production@digital.cabinet-office.gov.uk"
  # CF_PASSWORD
  - secure: UYvRRq3/WSAF5udIroJRoN0i4ha04K9tWf5ozXAidP9oF1o3kAdz7dMlb/UWE10KCki8WwYSKufsJknSC7yygg6BgkajpUFWZc36XWUgyIlXEti3kxjq8GhHUtVQpdH/Mp702DgzJCgA4Bwj9TlfkyP+PIYW4PfljRllJtPzqgxSur++23Q+kMmvA8T/GOEyab72ZjEMQmonl0Vxf6UWx/y7/4+XLj34OTzoYQ18utWfH9o9i1KUA8dYFCT3oCauGXF8Ra6iOPmNhBjvKrT9+foyYvfbwtL+o+tcbyBQM+p2toWUC2E5e+gIyed+woNnUMFGjGzkwzRe5evhH7RbssGMnkAHn19EGht+Ycdo5Wqh06kmb6sGVFa5EfvuX8AUHaOJrjBjS4ojHA9rmrkCrLvXpKECJi/NK2if5mk39ULtmtUzBBAjgPY3ZY34wweKrRgKz1Q2+Z59nJuX4/UM/KP3lrG0IWKIqdcrnoRaXsWADmf512zFw699+3rre6Bv7h08cyJZWAPWFhZiFibFOQXpT7uVeGyF2VcNrDjVzOiUFOWb7+5IRLi3Volp9o5OHuH1aOw3vNb2KqbIvJAFcQJF4l7c8Jopp6obeyBtXsupAVOTKZQnc9rokwDvyLbCNfseXXWNPekRD9+Ey8asSM+NauWLASFIWxNrRj6M5m0=
  # NPM_TOKEN
  - secure: "W9ykql6Ye8LoQwDaQ/HLqfv+elZtULj+ncOtq0v6JfNVq5YEy/vGXRC8Yb1V0BMLZhI91drC9CLtS8wbOdH9hFBoezMWIDcYLx7yBCMOFuvIYUCwSAvCGkdWcM4hjXWN2d8rYHK3K2YpXM4QT2vNpTzjg/ZI/L0FrHGwarjAS2PxYp05VhkHs2CknPtV8CXCW2Eo7A/BbTPpKqe0z8191XiqkEjcJo5b7+yqCdEgyCiJ7jlLu7SoFwbZ0AeI756ALQH1o+dMxzBqm9qp0EKtlS+ntrOzAapIEq8DycUrz7iRnjqZJHgS5ehE9kTf8I3PB3bwwxkDniOINvCMA92VkFIVFr7oDu/UJkfD0PjVeHCAoZb0sSu3sOpKNR9Bj08HFnVGv0pJEYBDjm2H3xH0w2qEiigDOPOZFiAbgevqmDRsyDWlOvIezL5YtKawjAbjv2EzEJq/J5zxjZTZNMokLAA4Am30uwAU5Nj0T/pqyjCG8xyoEm1he/AnIDGmXnpoQ/X3tqB+RIwh5+C7hoUNmX6VJy9D0f3iI6ggfmBEBJuCqf9aNC8iCmUq5ncWQ24Ylpo+qmYAgAHIc6M27TAsCQKWqeDymdhbIes2hXrdnj9gI+/G4Vjq9p30U8co0fIEKxX17z+BDeHwJUOk+kIjG8FMlQuk1jHhIU+BIhU1dQo="
  # Google Tag Manager ID â€“ different for production and preview builds
  - GTM_TAG="GTM-53XG2JT"

before_install:
  - if [[ `npm -v | cut -d. -f1` -lt 5 ]]; then npm i -g npm@latest; fi
  - npm config set //registry.npmjs.org/:_authToken=$NPM_TOKEN

install:
  - npm install --no-optional

before_deploy:
  - export PATH=$HOME:$PATH
  # Install CloudFoundry
  - travis_retry curl -L -o $HOME/cf.tgz "https://cli.run.pivotal.io/stable?release=linux64-binary&source=github"
  - tar xzvf $HOME/cf.tgz -C $HOME
  # Install Autopilot plugin for zero-downtime-push
  - travis_retry cf install-plugin autopilot -f -r CF-Community

deploy:
  provider: script
  script: "./bin/deploy-travis"
  skip_cleanup: true
  on:
    branch: master
